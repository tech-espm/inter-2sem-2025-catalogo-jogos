<div class="container-fluid-home">

	<!-- Carrossel principal de Lançamentos -->

	<% const jogos2025=jogos .filter(j=> j.dt_lancamento)
		.filter(j => {
		const d = new Date(j.dt_lancamento);
		return d.getFullYear() === 2025 && d.getMonth() >= 7;
		});
		%>

		<div id="carousel1" class="carousel slide custom-carousel carousel-comum" data-bs-ride="false" data-bs-wrap="true">
			<h1 class="subtitulo mt-3">Lançamentos Populares</h1>
			<% if (jogos2025.length> 0) { %>

				<!-- Indicadores -->
				<div class="carousel-indicators">
					<% for (let i=0; i < jogos2025.length; i++) { %>
						<button type="button" data-bs-target="#carousel1" data-bs-slide-to="<%= i %>"
							class="<%= i === 0 ? 'active' : '' %>" aria-label="Slide <%= i + 1 %>">
						</button>
						<% } %>
				</div>

				<!-- Imagens -->
				<div class="carousel-inner">
					<% for (let i=0; i < jogos2025.length; i++) { %>
						<div class="carousel-item <%= i === 0 ? 'active' : '' %>">
							<a class="link-carousel" href="/jogo/<%= jogos2025[i].id_jogo %>">
								<img src="/public/img/CapaJogos/<%= jogos2025[i].id_jogo %>.jpg" class="d-block w-100"
									alt="<%= jogos2025[i].nm_jogo %>">
							</a>
						</div>
						<% } %>
				</div>
				<% } %>

					<!-- Controles -->
					<button class="carousel-control-prev" type="button" data-bs-target="#carousel1"
						data-bs-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Anterior</span>
					</button>
					<button class="carousel-control-next" type="button" data-bs-target="#carousel1"
						data-bs-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Próximo</span>
					</button>
		</div>


		<!-- Carrossel de jogos de ação -->

		<div id="carousel-acao" class="carousel slide custom-carousel2 carousel-comum" data-bs-ride="false" data-bs-wrap="true">
			<h1 class="subtitulo mt-3">Jogos de Ação</h1>
			<div class="carousel-indicators"></div>
			<div class="carousel-inner"></div>

			<button class="carousel-control-prev" type="button" data-bs-target="#carousel-acao" data-bs-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Anterior</span>
			</button>
			<button class="carousel-control-next" type="button" data-bs-target="#carousel-acao" data-bs-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="visually-hidden">Próximo</span>
			</button>
		</div>

		<!-- Fonte das imagens -->
		<div id="carousel-acao-src" class="d-none">
			<% for (let i=0; i < jogos.length; i++) { %>
				<div class="col">
					<a class="card h-100" href="/jogo/<%= jogos[i].id_jogo %>">
						<img src="/public/img/CapaJogos/<%= jogos[i].id_jogo %>.jpg" class="card-img-top" alt="">
						<div class="card-body">
							<p class="card-text">
								<%= jogos[i].nm_jogo%>
							</p>
						</div>
					</a>
				</div>
				<% } %>
		</div>

		<!-- Script que constroi o carrossel baseado no tamanho da tela -->

		<script>
			function createResponsiveCarousel(carouselId, srcId, breakpoints = { sm: 1, md: 2, lg: 4 }) {

				const root = document.getElementById(carouselId);
				const inner = root.querySelector('.carousel-inner');
				const indicators = root.querySelector('.carousel-indicators');
				const src = document.getElementById(srcId);

				if (!root || !inner || !indicators || !src) {
					console.error("IDs inválidos no carrossel:", carouselId, srcId);
					return;
				}

				const items = [...src.children].map(el => el.outerHTML);

				function perSlide() {
					const w = window.innerWidth;
					if (w < 576) return breakpoints.sm;
					if (w < 992) return breakpoints.md;
					return breakpoints.lg;
				}

				function buildCarousel() {
					const n = perSlide();
					inner.innerHTML = "";
					indicators.innerHTML = "";

					items.forEach((_, idx) => {
						if (idx % n !== 0) return;

						const chunk = items.slice(idx, idx + n).join('');
						const active = idx === 0 ? "active" : "";

						inner.insertAdjacentHTML("beforeend", `
                			<div class="carousel-item ${active}">
                    			<div class="row g-3 row-cols-${n}">
                        			${chunk}
                    			</div>
                			</div>
            			`);

						indicators.insertAdjacentHTML("beforeend", `
                			<button type="button"
                    			data-bs-target="#${carouselId}"
                    			data-bs-slide-to="${idx / n}"
                    			class="${active}"
                    			aria-label="Slide ${idx / n + 1}">
                			</button>
            			`);
					});

					bootstrap.Carousel.getInstance(root)?.dispose();
					new bootstrap.Carousel(root, { ride: false, wrap: true });
				}

				
				let t;
				window.addEventListener("resize", () => {
					clearTimeout(t);
					t = setTimeout(buildCarousel, 150);
				});

				buildCarousel();
			}
		</script>

		<script>
			createResponsiveCarousel("carousel-acao", "carousel-acao-src");
		</script>





		<!-- Aviso de login e conta -->

		<div class="aviso">
			<p>Faça login para uma experiência personalizada.</p>
			<a class="botaov" href="login">Entrar<a>
					<p class="separar">Escreva e compartilhe suas resenhas. <a class="cadastrar"
							href="cadastro">Cadastre-se</a> para salvar seus jogos. </p>

		</div>

</div>